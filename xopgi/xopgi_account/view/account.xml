<?xml version="1.0" encoding="UTF-8"?>
<openerp>
  <data>
    <record id="xopgi_account_account_tree" model="ir.ui.view">
      <field name="name">xopgi.account.account.tree</field>
      <field name="model">account.account</field>
      <field name="inherit_id" ref="account.view_account_tree"/>
      <field name="arch" type="xml">
        <field name="company_currency_id" position="attributes">
          <attribute name="string">Currency</attribute>
        </field>
        <field name="company_currency_id" position="after">
          <field name="foreign_balance" string="Foreign Balance" />
          <field name="currency_id" string="Second Currency" />
        </field>
      </field>
    </record>

    <!-- TODO: This entire view depends on "Allow multi-currency" being
         checked.

         This should be only installed if xopgi_account is installed and "Allow
         multi-currency" is marked.

         ~med is having the same problem with the Fax field.  He is going to
         solve it with a configuration as well.  So let's, delay this issue
         until ~med knows how to solve it.
    -->
    <record id="xopgi_account_move_view_form" model="ir.ui.view">
      <field name="name">xopgi.view.move.form</field>
      <field name="model">account.move</field>
      <field name="inherit_id" ref="account.view_move_form" />
      <field name="arch" type="xml">
        <xpath expr="//field[@name='line_id']/tree" position="attributes">
          <attribute name="editable">bottom</attribute>
        </xpath>
        <xpath expr="//group/field[@name='journal_id']" position="replace">
          <field
              name="journal_id"
              on_change="onchange_journal(journal_id, period_id, date, context)"
              />
        </xpath>
        <xpath expr="//tree/field[@name='invoice']" position="attributes">
          <attribute name="invisible">True</attribute>
        </xpath>
        <xpath expr="//tree/field[@name='date_maturity']" position="attributes">
          <attribute name="invisible">True</attribute>
        </xpath>
        <xpath expr="//tree/field[@name='state']" position="attributes">
          <attribute name="invisible">True</attribute>
        </xpath>
      </field>
    </record>

    <record id="xopgi_account_view_move_line_tree" model="ir.ui.view">
      <field name="name">xopgi.view.move.line.tree</field>
      <field name="model">account.move.line</field>
      <field name="inherit_id" ref="account.view_move_line_tree" />
      <field name="arch" type="xml">
        <field name="journal_id" position="attributes">
          <attribute name="invisible">True</attribute>
        </field>
        <field name="ref" position="attributes">
          <attribute name="invisible">True</attribute>
        </field>
        <field name="period_id" position="attributes">
          <attribute name="invisible">True</attribute>
        </field>
      </field>
    </record>

    <record id="xopgi_account_invoice_form" model="ir.ui.view">
      <field name="name">xopgi.account.invoice.form</field>
      <field name="model">account.invoice</field>
      <field name="inherit_id" ref="account.invoice_form" />
      <field name="arch" type="xml">
        <button string="Refund Invoice" position="attributes">
          <attribute name="context">{'invoice_company_id': company_id}</attribute>
        </button>
        <field name="invoice_line" position="attributes">
          <attribute name="context">{'type': type, 'force_company': company_id}</attribute>
        </field>
        <field name="journal_id" position="attributes">
          <attribute name="widget">False</attribute>
        </field>
      </field>
    </record>

    <record id="xopgi_account_payment_form" model="ir.ui.view">
      <field name="name">xopgi.account.payment.form</field>
      <field name="model">account.voucher</field>
      <field name="inherit_id" ref="account_voucher.view_vendor_receipt_form" />
      <field name="arch" type="xml">
        <field name="journal_id" position="attributes">
          <attribute name="domain">[('type','in',['bank', 'cash']), ('company_id', '=', company_id)]</attribute>
          <attribute name="options">{"no_open":True}</attribute>
          <attribute name="widget">False</attribute>
        </field>
        <field name="company_id" position="attributes">
          <attribute name="on_change">onchange_company()</attribute>
        </field>
      </field>
    </record>

    <record id="xopgi_account_payment_in_form" model="ir.ui.view">
      <field name="name">xopgi.account.payment.form</field>
      <field name="model">account.voucher</field>
      <field name="inherit_id" ref="account_voucher.view_vendor_receipt_dialog_form" />
      <field name="arch" type="xml">
        <field name="journal_id" position="attributes">
          <attribute name="domain">[('type','in',['bank', 'cash']), ('company_id', '=', company_id)]</attribute>
          <attribute name="widget" eval="False"/>
          <attribute name="options">{"no_open":True}</attribute>
        </field>
        <field name="period_id" position="attributes">
          <attribute name="domain">[('company_id', '=', company_id)]</attribute>
        </field>
        <field name="company_id" position="attributes">
          <attribute name="on_change">onchange_company()</attribute>
        </field>
      </field>
    </record>

    <record id="xopgi_account_bank_statement_form" model="ir.ui.view">
      <field name="name">xopgi.account.bank.statement.form</field>
      <field name="model">account.bank.statement</field>
      <field name="inherit_id" ref="account.view_bank_statement_form2" />
      <field name="arch" type="xml">
        <field name="period_id" position="attributes">
          <attribute name="context">{'company_id': company_id}</attribute>
        </field>
      </field>
    </record>

    <!-- Invoice -->

    <record id="xopgi_account_invoice_tree" model="ir.ui.view">
      <field name="name">xopgi.account.invoice.tree</field>
      <field name="model">account.invoice</field>
      <field name="inherit_id" ref="account.invoice_tree" />
      <field name="arch" type="xml">
        <field name="date_due" position="replace" >
          <field name="name" />
        </field>
      </field>
    </record>

    <record id="xopgi_account_voucher_payment_form" model="ir.ui.view">
      <field name="name">xopgi.account.voucher.payment.form</field>
      <field name="model">account.voucher</field>
      <field name="inherit_id" ref="account_voucher.view_vendor_payment_form" />
      <field name="arch" type="xml">
        <field name="journal_id" position="attributes">
          <attribute name="widget">False</attribute>
        </field>
      </field>
    </record>

    <record id="xopgi_view_account_invoice_filter" model="ir.ui.view">
      <field name="name">xopgi.view.account.invoice.filter</field>
      <field name="model">account.invoice</field>
      <field name="inherit_id" ref="account.view_account_invoice_filter" />
      <field name="arch" type="xml">
        <filter string="Partner" position="before" >
          <filter string="Name" icon="terp-partner" domain="[]" context="{'group_by':'name'}"/>
          <filter string="Origin" icon="terp-partner" domain="[]" context="{'group_by':'origin'}"/>
        </filter>
      </field>
    </record>

    <!-- Voucher -->

    <record id="xopgi_account_voucher_customer_form_view" model="ir.ui.view">
      <field name="name">xopgi.account.voucher.customer.form.view</field>
      <field name="model">account.voucher</field>
      <field name="inherit_id" ref="account_voucher.view_vendor_receipt_form" />
      <field name="arch" type="xml">
        <xpath expr="//tree/field[@name='move_line_id']" position="after" >
          <field name="invoice" readonly="1" />
        </xpath>
      </field>
    </record>

    <record id="xopgi_account_voucher_supplier_form_view" model="ir.ui.view">
      <field name="name">xopgi.account.voucher.supplier.form.view</field>
      <field name="model">account.voucher</field>
      <field name="inherit_id" ref="account_voucher.view_vendor_payment_form" />
      <field name="arch" type="xml">
        <xpath expr="//tree/field[@name='move_line_id']" position="after" >
          <field name="invoice" readonly="1" />
        </xpath>
      </field>
    </record>

  </data>
</openerp>
